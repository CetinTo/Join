<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Raleway:ital,wght@0,100..900;1,100..900&family=Rubik+Vinyl&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="../img/capa.png" type="image/png" />
    <link rel="stylesheet" href="../styles/header.css" />
    <link rel="stylesheet" href="../styles/side-menu.css" />
    <link rel="stylesheet" href="../styles/standard.css" />
    <link rel="stylesheet" href="../styles/profile-dropdown.css" />
    <link rel="stylesheet" href="../styles/main-add-task-style.css" />
    <link rel="stylesheet" href="../styles/summary.css">


    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/de.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <script src="../scripts/datepicker.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>




    <script src="../scripts/addTaskScripts.js" defer></script>
    <script src="../scripts/addTaskContacts.js"></script>
    <script src="../scripts/dropdown.js"></script>
    <script src="../scripts/addTask.js"></script>
    <script src="../scripts/user.js"></script>
    <script src="../scripts/logout.js"></script>
    <script src="../scripts/logout.js"></script>
    
    <title>Document</title>
  </head>
  <body>
    <div class="side-menu">
      <div class="logo-content-container">
        <div class="logo">
          <img src="../img/capa_white.png" alt="Join.Logo" class="logo" />
        </div>
        <div class="menu-content">
          <div class="menu-content-div">
            <a href="../index.html"><img src="../img/icon/summary.png" alt="summary" />Summary</a>
          </div>
          <div class="selected-menu">
            <a href="./addtask.html"><img src="../img/icon/add_task.png" alt="add_task" /> Add Task</a>
          </div>
          <div class="menu-content-div">
            <a href="./board.html"><img src="../img/icon/board.png" alt="board" />Board</a>
          </div>
          <div class="menu-content-div">
            <a href="./contacts.html"><img src="../img/icon/contacts.png" alt="contacts" />Contacts</a>
          </div>
        </div>
      </div>
      <div class="policy-container">
        <div class="policy-container-div">
          <div><a href="../resources/private-policy/privacy-policy.html">Privacy Policy</a></div>
          <div><a href="../resources/legal-notice/legal-notice.html">Legal Notice</a></div>
        </div>
      </div>
    </div>
    <div class="main-div">
      <div class="header">
        <div class="main-header">
          <div class="header-logo-none-resp">
            <img class="header-Logo" src="../img/capa.png" alt />
          </div>
          <div class="headline-header">Kanban Project Management Tool</div>
          <div class="header-right-side">
            <div>
              <a href="../resources/help/help.html"><img src="../img/icon/help.png" alt="help" /></a>
            </div>
            <div class="account">
              <div>G</div>
            </div>
          </div>
        </div>
      </div>
      <div class="dropdown-menu">
        <div class="dropdown-content">
          <div class="dropdown-content-div">
            <div class="dropdown-content-div-text">
              <div>
                <a href="../resources/help/help.html">Help</a>
              </div>
            </div>
          </div>
          <div class="dropdown-content-div">
            <div class="dropdown-content-div-text">
              <div>
                <a href="../resources/legal-notice/legal-notice.html">Legal notice</a>
              </div>
            </div>
          </div>
          <div class="dropdown-content-div">
            <div class="dropdown-content-div-text">
              <div>
                <a href="../resources/private-policy/privacy-policy.html">Privacy Policy</a>
              </div>
            </div>
          </div>
          <div class="dropdown-content-div" onclick="logoutToLogin()">
            <div class="dropdown-content-div-text">
              <div>
                <a href="../html/login.html">Logout</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="main-section">
        <div class="headline-div">
          <h1>Add Task</h1>
        </div>
        <div class="main-form-div">
          <div class="form-div">
            <form class="form-left">
              <div class="flrow">
                <span>Title<required-field>*</required-field></span>
                <input type="text" class="input" placeholder="Enter a title" />
              </div>
              <div class="flrow">
                <span>Description</span>
                <textarea placeholder="Enter a Description" class="description"></textarea>
              </div>
              <div class="flrow">
                <span>Assigned to</span>
                <select class="select-contact" style="display: none;">
                  <option value="" disabled selected>Select contacts to assign</option>
                </select>
                <div class="custom-dropdown">
                  <div class="dropdown-search-container">
                    <input type="text" class="dropdown-search" placeholder="Select to assign" onclick="toggleDropdown()" />
                    <img src="../img/arrow_drop_down.png" alt="Search Icon" class="search-icon" onclick="toggleDropdown()" />
                    <img src="../img/arrow_drop_down_aktive.png" alt="Search Icon" class="search-icon-active" onclick="toggleDropdown()" />
                  </div>
                  <div class="dropdown-list"></div>
                  <div class="assigned-to-profiles-container"></div>
                </div>
              </div>
            </form>
            <hr />
            <form class="form-right">
              <div class="flrow">
                <span>Due date<required-field>*</required-field></span>
                <div class="date-input-container">
                  <input type="text" id="date-input" class="date-input" placeholder="dd/mm/yyyy" />
                  <img src="../img/icon/event.png" alt="Calendar Icon" class="calendar-icon" 
                       onclick="openDatePickerAddTask('date-input')" />
                </div>
              </div>
              <div class="flrow">
                <span>Prio</span>
                <div class="priority-container">
                  <div class="priority-button-urgent" onclick="setPriority('urgent')">
                    Urgent <img src="../img/icon-urgent.png" alt="urgent-icon" class="urgent-icon-active" />
                  </div>
                  <div class="priority-button-medium" onclick="setPriority('medium')">
                    Medium <img src="../img/icon-medium.png" alt="" class="medium-vector" />
                  </div>
                  <div class="priority-button-low" onclick="setPriority('low')">
                    Low <img src="../img/icon-low.png" alt="" />
                  </div>
                </div>
              </div>
              <div class="flrow">
                <span>Category<required-field>*</required-field></span>
                <select class="select-task" style="display: none;">
                  <option value="" disabled selected>Select task category</option>
                  <option value="todo">Technical Task</option>
                  <option value="inprogress">User Story</option>
                </select>
                <div class="category-dropdown" tabindex="0">
                  <div class="category-selected">Select task category</div>
                  <img src="../img/arrow_drop_down.png" alt="Dropdown Icon" class="dropdown-icon" />
                  <div class="category-options">
                    <div class="category-item" data-value="Technical task">Technical Task</div>
                    <div class="category-item" data-value="User Story">User Story</div>
                  </div>
                </div>
              </div>
              <div class="subtask-container">
                <span>Subtasks</span>
                <div class="subtask-wrapper">
                  <input class="subtask" type="text" placeholder="Add new subtask" />
                  <div class="subtask-icons-div" style="display: none;">
                    <img src="../img/subtask-delete.png" alt="Delete Subtask" class="subtask-icon delete-icon" />
                    <hr class="subtask-hr" />
                    <img src="../img/subtask-check.png" alt="Check Subtask" class="subtask-icon check-icon" />
                  </div>
                  <img src="../img/icon/add.png" alt="Add Subtask" class="subtask-icon add-icon" id="addSubtask" />
                </div>
                <div class="subtasks-scroll-container"></div>
              </div>
              <span class="required-text"><required-field>*</required-field>This field is required</span>

            </form>

          </div>
        </div>
      </div>
      <div class="footer">
        <div class="footer-cover-div">
          <div class="footer-mid-div">
            <div>
              <div class="dn-925px">
                <span><required-field>*</required-field>This field is required</span>
              </div>
            </div>
            <div class="footer-btn">
              <div class="clear-btn">Clear x</div>
              <div class="create-btn">Create <img src="../img/icon/check.png" alt="" /></div>
            </div>
          </div>
        </div>
      </div>
      <div class="side-menu-bottom">
        <div class="logo-content-container-bottom">
          <div class="menu-content-bottom">
            <div class="bottom-menu">
              <a href="../index.html">
                <img src="../img/icon/summary.png" alt="summary" />Summary
              </a>
            </div>
            <div class="  menu-content-div resp-cont-div bottom-menu">
              <a href="../html/board.html">
                <img src="../img/icon/board.png" alt="board" />Board
              </a>
            </div>
            <div class="selected-menu  menu-content-div bottom-menu">
              <a href="./addtask.html">
                <img src="../img/icon/add_task.png" alt="add_task" />Add Task
              </a>
            </div>
            <div class="menu-content-div bottom-menu">
              <a href="./contacts.html">
                <img src="../img/icon/contacts.png" alt="contacts" />Contacts
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
/**
 * Sets up click event listeners on all clear buttons to reload the page.
 */
 function setupClearButtons() {
  document.querySelectorAll(".clear-btn").forEach(item => {
    item.addEventListener("click", () => location.reload());
  });
}

/**
 * Sets up the account button click event to toggle the dropdown menu.
 */
function setupAccountDropdown() {
  document.querySelector(".account").addEventListener("click", event => {
    event.stopPropagation();
    document.querySelector(".dropdown-menu").classList.toggle("show");
  });
}

/**
 * Sets up a document click listener to close the dropdown when clicking outside.
 */
function setupOutsideDropdownClick() {
  document.addEventListener("click", event => {
    const dropdown = document.querySelector(".dropdown-menu");
    if (!dropdown.contains(event.target) && dropdown.classList.contains("show")) {
      dropdown.classList.remove("show");
    }
  });
}

/**
 * Handles focus and blur events on the subtask input field.
 * @param {HTMLElement} subtaskInput - The subtask input element.
 * @param {HTMLElement} addIcon - The add icon element.
 * @param {HTMLElement} iconsDiv - The container for subtask icons.
 */
function handleSubtaskInputFocusBlur(subtaskInput, addIcon, iconsDiv) {
  subtaskInput.addEventListener("focus", () => {
    addIcon.style.display = "none";
    iconsDiv.style.display = "flex";
  });
  subtaskInput.addEventListener("blur", function () {
    if (!this.value) {
      addIcon.style.display = "block";
      iconsDiv.style.display = "none";
    }
  });
}

/**
 * Sets up the delete icon click event for the subtask input.
 * @param {HTMLElement} subtaskInput - The subtask input element.
 * @param {HTMLElement} addIcon - The add icon element.
 * @param {HTMLElement} iconsDiv - The container for subtask icons.
 * @param {HTMLElement} deleteIcon - The delete icon element.
 */
function setupDeleteIcon(subtaskInput, addIcon, iconsDiv, deleteIcon) {
  deleteIcon.addEventListener("click", () => {
    subtaskInput.value = "";
    addIcon.style.display = "block";
    iconsDiv.style.display = "none";
    subtaskInput.focus();
  });
}

/**
 * Creates a new subtask element with a trash icon.
 * @param {string} text - The subtask text.
 * @returns {HTMLElement} The new subtask element.
 */
 function createSubtaskElement(text) {
  const newSubtask = createSubtaskContainer();
  newSubtask.innerHTML = generateSubtaskInnerHTML(text);
  attachTrashEvent(newSubtask);
  return newSubtask;
}

/**
 * Creates the container element for the subtask.
 * @returns {HTMLElement} The container element.
 */
function createSubtaskContainer() {
  const element = document.createElement("div");
  element.className = "added-subtasks";
  return element;
}

/**
 * Generates the inner HTML for the subtask.
 * @param {string} text - The subtask text.
 * @returns {string} The HTML string.
 */
function generateSubtaskInnerHTML(text) {
  return `
    <div class="flexrow">
      <div>â€¢</div>
      <div class="subtask-added-tasks">${text}</div>
    </div>
    <div class="added-subtask-icons">
      <div><img src="../img/pen.png" alt="pen"></div>
      <hr class="subtask-hr">
      <div class="trash-icon"><img src="../img/trash.png" alt="trash"></div>
    </div>
  `;
}

/**
 * Attaches the click event to the trash icon for removing the subtask.
 * @param {HTMLElement} newSubtask - The subtask element.
 */
function attachTrashEvent(newSubtask) {
  const trashIcon = newSubtask.querySelector(".trash-icon");
  trashIcon.addEventListener("click", () => {
    newSubtask.remove();
    validateForm();
  });
}


/**
 * Sets up the check icon click event to add a new subtask.
 * @param {HTMLElement} subtaskInput - The subtask input element.
 * @param {HTMLElement} addIcon - The add icon element.
 * @param {HTMLElement} iconsDiv - The container for subtask icons.
 * @param {HTMLElement} checkIcon - The check icon element.
 */
function setupCheckIcon(subtaskInput, addIcon, iconsDiv, checkIcon) {
  checkIcon.addEventListener("click", () => {
    const subtaskText = subtaskInput.value.trim();
    if (subtaskText) {
      const newSubtask = createSubtaskElement(subtaskText);
      document.querySelector(".subtasks-scroll-container").appendChild(newSubtask);
      subtaskInput.value = "";
      addIcon.style.display = "block";
      iconsDiv.style.display = "none";
      validateForm();
    }
  });
}

/**
 * Initializes all subtask-related event listeners.
 */
function setupSubtaskListeners() {
  const subtaskInput = document.querySelector(".subtask");
  const addIcon = document.querySelector(".add-icon");
  const iconsDiv = document.querySelector(".subtask-icons-div");
  const deleteIcon = document.querySelector(".delete-icon");
  const checkIcon = document.querySelector(".check-icon");
  handleSubtaskInputFocusBlur(subtaskInput, addIcon, iconsDiv);
  setupDeleteIcon(subtaskInput, addIcon, iconsDiv, deleteIcon);
  setupCheckIcon(subtaskInput, addIcon, iconsDiv, checkIcon);
}

// Initialize all functionalities once the DOM is fully loaded.
document.addEventListener("DOMContentLoaded", () => {
  setupClearButtons();
  setupAccountDropdown();
  setupOutsideDropdownClick();
  setupSubtaskListeners();
});

    </script>
  </body>
</html>